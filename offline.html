<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå - Austam Good WMS</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #333;
        }
        
        .offline-container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.2);
            max-width: 500px;
            margin: 20px;
        }
        
        .offline-icon {
            font-size: 80px;
            color: #6c757d;
            margin-bottom: 20px;
        }
        
        .offline-title {
            font-size: 32px;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 15px;
        }
        
        .offline-subtitle {
            font-size: 18px;
            color: #6c757d;
            margin-bottom: 30px;
            line-height: 1.6;
        }
        
        .features-list {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin: 25px 0;
            text-align: left;
        }
        
        .features-title {
            font-size: 20px;
            font-weight: 600;
            color: #495057;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .feature-item {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
            padding: 8px 0;
        }
        
        .feature-icon {
            color: #28a745;
            margin-right: 12px;
            font-size: 18px;
            width: 20px;
        }
        
        .feature-text {
            color: #495057;
            font-size: 16px;
        }
        
        .retry-btn {
            background: linear-gradient(45deg, #007bff, #0056b3);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px;
            min-width: 150px;
        }
        
        .retry-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,123,255,0.3);
        }
        
        .cache-btn {
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 50px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
        }
        
        .cache-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 5px 15px rgba(40,167,69,0.3);
        }
        
        .status-indicator {
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            font-size: 14px;
        }
        
        .status-offline {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        .status-online {
            background: #d1f2eb;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .sync-indicator {
            margin-top: 15px;
            font-size: 14px;
            color: #6c757d;
        }
        
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #007bff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .hidden {
            display: none;
        }
        
        @media (max-width: 600px) {
            .offline-container {
                padding: 30px 20px;
                margin: 10px;
            }
            
            .offline-title {
                font-size: 28px;
            }
            
            .offline-subtitle {
                font-size: 16px;
            }
        }
    </style>
</head>
<body>
    <div class="offline-container">
        <!-- Offline Icon -->
        <div class="offline-icon">
            üì±üíî
        </div>
        
        <!-- Title and Subtitle -->
        <h1 class="offline-title">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï</h1>
        <p class="offline-subtitle">
            ‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÇ‡∏´‡∏°‡∏î‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå ‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô‡πÑ‡∏î‡πâ
        </p>
        
        <!-- Available Features -->
        <div class="features-list">
            <div class="features-title">‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå</div>
            
            <div class="feature-item">
                <div class="feature-icon">‚úÖ</div>
                <div class="feature-text">‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÅ‡∏Ñ‡∏ä‡πÑ‡∏ß‡πâ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</div>
            </div>
            
            <div class="feature-item">
                <div class="feature-icon">‚úÖ</div>
                <div class="feature-text">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°‡πÉ‡∏´‡∏°‡πà (‡∏à‡∏∞‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå)</div>
            </div>
            
            <div class="feature-item">
                <div class="feature-icon">‚úÖ</div>
                <div class="feature-text">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡πÅ‡∏Ñ‡∏ä</div>
            </div>
            
            <div class="feature-item">
                <div class="feature-icon">‚úÖ</div>
                <div class="feature-text">‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô</div>
            </div>
            
            <div class="feature-item">
                <div class="feature-icon">‚è≥</div>
                <div class="feature-text">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå (‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå)</div>
            </div>
        </div>
        
        <!-- Action Buttons -->
        <button class="retry-btn" onclick="retryConnection()">
            <span id="retry-text">‡∏•‡∏≠‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÉ‡∏´‡∏°‡πà</span>
            <span id="retry-spinner" class="loading-spinner hidden"></span>
        </button>
        
        <br>
        
        <button class="cache-btn" onclick="goToHome()">
            üè† ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å
        </button>
        
        <button class="cache-btn" onclick="clearCache()">
            üóëÔ∏è ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏Ñ‡∏ä
        </button>
        
        <!-- Status Indicator -->
        <div id="status-indicator" class="status-indicator status-offline">
            üî¥ ‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå - ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï
        </div>
        
        <!-- Sync Status -->
        <div id="sync-indicator" class="sync-indicator">
            <span id="pending-sync-count">0</span> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ã‡∏¥‡∏á‡∏Ñ‡πå
        </div>
    </div>
    
    <script>
        // Check online status
        function updateOnlineStatus() {
            const statusIndicator = document.getElementById('status-indicator');
            const retryBtn = document.querySelector('.retry-btn');
            
            if (navigator.onLine) {
                statusIndicator.textContent = 'üü¢ ‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå - ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à';
                statusIndicator.className = 'status-indicator status-online';
                retryBtn.textContent = 'üè† ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö';
                retryBtn.onclick = goToHome;
                
                // Auto redirect after 2 seconds
                setTimeout(() => {
                    window.location.href = '/wms-uft/';
                }, 2000);
            } else {
                statusIndicator.textContent = 'üî¥ ‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå - ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï';
                statusIndicator.className = 'status-indicator status-offline';
                retryBtn.textContent = '‡∏•‡∏≠‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÉ‡∏´‡∏°‡πà';
                retryBtn.onclick = retryConnection;
            }
        }
        
        // Retry connection
        async function retryConnection() {
            const retryText = document.getElementById('retry-text');
            const retrySpinner = document.getElementById('retry-spinner');
            const retryBtn = document.querySelector('.retry-btn');
            
            retryBtn.disabled = true;
            retryText.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...';
            retrySpinner.classList.remove('hidden');
            
            try {
                // Try to fetch a small resource to test connection
                const response = await fetch('/wms-uft/api/refresh-session.php', {
                    method: 'GET',
                    cache: 'no-cache'
                });
                
                if (response.ok) {
                    retryText.textContent = '‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!';
                    retrySpinner.classList.add('hidden');
                    
                    setTimeout(() => {
                        window.location.href = '/wms-uft/';
                    }, 1000);
                } else {
                    throw new Error('Connection failed');
                }
            } catch (error) {
                retryText.textContent = '‡∏•‡∏≠‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÉ‡∏´‡∏°‡πà';
                retrySpinner.classList.add('hidden');
                retryBtn.disabled = false;
                
                // Show error message briefly
                const statusIndicator = document.getElementById('status-indicator');
                const originalText = statusIndicator.textContent;
                statusIndicator.textContent = '‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà';
                
                setTimeout(() => {
                    statusIndicator.textContent = originalText;
                }, 3000);
            }
        }
        
        // Go to home page
        function goToHome() {
            window.location.href = '/wms-uft/';
        }
        
        // Clear cache
        async function clearCache() {
            if ('serviceWorker' in navigator) {
                try {
                    const registration = await navigator.serviceWorker.getRegistration();
                    if (registration) {
                        // Send message to service worker to clear cache
                        const messageChannel = new MessageChannel();
                        
                        messageChannel.port1.onmessage = function(event) {
                            if (event.data.success) {
                                alert('‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏Ñ‡∏ä‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
                                location.reload();
                            }
                        };
                        
                        registration.active.postMessage({
                            type: 'CLEAR_CACHE'
                        }, [messageChannel.port2]);
                    }
                } catch (error) {
                    console.error('Failed to clear cache:', error);
                    alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏Ñ‡∏ä‡πÑ‡∏î‡πâ');
                }
            }
        }
        
        // Check for pending sync items
        async function checkPendingSync() {
            try {
                if ('indexedDB' in window) {
                    const request = indexedDB.open('AustamWMS', 1);
                    
                    request.onsuccess = function(event) {
                        const db = event.target.result;
                        
                        if (db.objectStoreNames.contains('sync_queue')) {
                            const transaction = db.transaction(['sync_queue'], 'readonly');
                            const store = transaction.objectStore('sync_queue');
                            const countRequest = store.count();
                            
                            countRequest.onsuccess = function() {
                                const count = countRequest.result;
                                document.getElementById('pending-sync-count').textContent = count;
                                
                                if (count > 0) {
                                    document.getElementById('sync-indicator').style.color = '#dc3545';
                                }
                            };
                        }
                    };
                }
            } catch (error) {
                console.error('Failed to check pending sync:', error);
            }
        }
        
        // Event listeners
        window.addEventListener('online', updateOnlineStatus);
        window.addEventListener('offline', updateOnlineStatus);
        
        // Initialize
        updateOnlineStatus();
        checkPendingSync();
        
        // Check connection every 30 seconds
        setInterval(updateOnlineStatus, 30000);
        setInterval(checkPendingSync, 10000);
        
        // Register service worker if not already registered
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/wms-uft/sw.js')
                .then(registration => {
                    console.log('Service Worker registered from offline page');
                })
                .catch(error => {
                    console.error('Service Worker registration failed:', error);
                });
        }
    </script>
</body>
</html>